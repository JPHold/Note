[TOC]

# 创建服务

## 镜像在私有注册库中
**要带上--with-registry-auth配置**
1. 先登录
```
docker login registry.example.com
```

2. 带上注册库的信息
```
 docker service  create --with-registry-auth --name my_service registry.example.com/acme/my_image:latest
```

# 更新服务
* 想对外发，可更新对外发布端口配置
`docker service update --publish-add 80 xxxServiceName`

# 删除服务
`docker service remove xxxServiceName`

# 配置清单

## 运行环境
-   使用`--env`标志的环境变量
-   使用`--workdir`标志的容器内的工作目录
-   使用`--user`标志的用户名或 UID

```
 docker service create --name helloworld \
  --env MYVAR=myvalue \
  --workdir /tmp \
  --user my_user \
  alpine ping docker.com
```

## 更新服务的执行命令
```
docker service update --args "ping docker.com" helloworld
```

## 指定镜像
* 创建服务时的指定
```
docker service create --name="myservice" ubuntu:latest
```

* 更新服务时的指定
`docker service update --image xxxImage xxxServiceName`

## 发布端口
因为一个节点会运行服务的多个任务实例，需要提供负载能力将请求路由到这些任务中，提供了两种方式：1、swarm提供的路由网络 2、自定义路由框架

### 路由网络
每个工作节点都监听对外的端口，但不是每个节点都运行任务实例；这不会有问题，因为路由网络会将请求路由真正执任务的节点
