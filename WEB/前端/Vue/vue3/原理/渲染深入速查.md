[TOC]

[渲染机制](https://cn.vuejs.org/guide/extras/rendering-mechanism.html)

# 虚拟DOM

>  由react提出
>  ，虚拟DOM是一个树形结构，在内存中维护一个目标UI所需的数据结构
> ，然后由渲染器负责，与真实DOM保持同步，构建成真实DOM树，**这个过程称为挂载**
> ，如果有两份虚拟DOM对应一个真实DOM，那么渲染器会遍历两者，找出两者的区别，并应用到真实DOM上，**这个过程称为：更新、对比、协调**

## 渲染流程
 ![[渲染流程.excalidraw]]


# 用模板还是渲染函数

> 模板最终会被编译成渲染函数，推荐使用模板：
1. 接近原生HTML，方便理解，可以使用CSS样式
2. 由于其确定的语法，更容易对模板做静态分析。Vue 的模板编译器能使用许多编译时优化，来提升虚拟 DOM 的性能表现 

# 提升虚拟DOM性能的手段
> **都是vue内部自动完成**

## 静态提升

1. 这些静态HTML不需要每次都重新渲染， 因此vue将这些vnode创建函数提升到这个模板的渲染函数之外
2. 当有足够多的静态元素时，会压缩成一个静态vnode（具体多少个开始压缩，看：[[#^70d946]]），通过innerHTML来挂载，**并且会被缓存和复用：** 初次挂载后缓存相应的DOM节点，当需要复用时，使用原生的cloneNode()拷贝新的DOM节点

[vue3模板在线编译例子](https://template-explorer.vuejs.org/#eyJzcmMiOiI8ZGl2PlxuICA8ZGl2IGNsYXNzPVwiZm9vXCI+Zm9vPC9kaXY+XG4gIDxkaXYgY2xhc3M9XCJmb29cIj5mb288L2Rpdj5cbiAgPGRpdiBjbGFzcz1cImZvb1wiPmZvbzwvZGl2PlxuICA8ZGl2IGNsYXNzPVwiZm9vXCI+Zm9vPC9kaXY+XG4gIDxkaXYgY2xhc3M9XCJmb29cIj5mb288L2Rpdj5cbiAgPGRpdj57eyBkeW5hbWljIH19PC9kaXY+XG48L2Rpdj4iLCJzc3IiOmZhbHNlLCJvcHRpb25zIjp7ImhvaXN0U3RhdGljIjp0cnVlfX0=)
通过测试上面例子发现，从5个静态元素开始，就变成静态节点 ^70d946

4个：
![[Pasted image 20230414110515.png]]
5个：
![[Pasted image 20230414110608.png]] 