[TOC]
（carte目前还有很多坑，没办法使用）[[2021-08(34)]]

# 安装Carte
[Set Up a Carte Cluster](https://help.hitachivantara.com/Documentation/Pentaho/9.1/Products/Set_Up_a_Carte_Cluster)

## 特性
| 特性 | 说明 |
| ---- | ---- |
| 单机部署 |  |
| 集群部署 |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |

## 一主三从集群
> window系统
> 使用bat文件

1. master
`./Carte.bat pwd/carte-config-master-19090.xml`

2. 三个slaver
`./Carte.bat pwd/carte-config-master-19091.xml`
`./Carte.bat pwd/carte-config-master-19092.xml`
`./Carte.bat pwd/carte-config-master-19093.xml`

## 集成到kettle客户端
> 使用carte集群，部署了四个节点

### 配置Slaver server

^f809e4

随便创建job或transformations，即可在左侧看到Slaver server
![[Pasted image 20210825180257.png]]
如果是master，勾选框框
![[Pasted image 20210825180322.png]]
slaver如下
![[Pasted image 20210825180409.png]]
点击share，后面打开的作业和转换都可以复用
![[Pasted image 20210825180543.png]]
最终如下：
![[Pasted image 20210825180445.png]]

### 创建运行配置
[Run transformations in a cluster](https://help.hitachivantara.com/Documentation/Pentaho/9.1/Products/Set_Up_a_Carte_Cluster#Run_transformations_in_a_cluster)
![[Pasted image 20210825180723.png]]

1. 创建运行配置
![[Pasted image 20210825180745.png]]
 ^d82755
2. 选择Slave server，并选择[[#^f809e4]]配置的master
![[Pasted image 20210825180839.png]]

### 使用carte执行作业或转换
1. 不能使用run，run是在本地执行
![[Pasted image 20210825180937.png]]

2. 选择运行配置为carte服务[[#^d82755]]
![[Pasted image 20210825181115.png]]

### 并行任务
[Run transformations in a cluster](https://help.hitachivantara.com/Documentation/Pentaho/9.1/Products/Set_Up_a_Carte_Cluster#Run_transformations_in_a_cluster)
[Kettle的集群排序 2——(基于Windows)](https://www.cnblogs.com/inuyasha1027/p/kettle_cluster_sorting2.html)
尝试了，排序并没有分到其它slaver执行，全部都在master执行！！！[[2021-08(34)]]
demo在[[README]]

# Carte web应用的接口清单
[Carte APIs](https://help.hitachivantara.com/Documentation/Pentaho/9.1/Developer_center/REST_API_Reference/Carte)
![[Pasted image 20210824175448.png]]
包含如下：
1. 管理Server应用本身的API
2. 管理转换本身的API
3. 管理作业本身的API

# 调用
## 认证
* **因为carte设置登录认证，所以调用api需要添加认证信息**
这篇是所有后台服务应用的通用认证讲解，carte服务并没有支持cookie方式（没找到登录接口：/j_spring_security_check）
[Authenticate with the Server Before Making Service Calls](https://help.hitachivantara.com/Documentation/Pentaho/9.1/Developer_center/REST_API_Reference#Authenticate_with_the_Server_Before_Making_Service_Calls)
两种方式：
1. cookie
先调用应用的登录接口，生成的cookie是基于当前主机的；除非过期，否则后续调用都无须重新认证。

2. 每次api调用前，在header设置basic authentication；这种方式是每次都认证
入参是：Authorization: Basic “username:password”的base64加密
比如账户密码是kettle、kettle，那么header如下：
`Authorization: Basic a2V0dGxlOmtldHRsZQ==`

## 其它API
比如注册作业这个api，官方就没讲清楚，入参填什么都说得很模糊；放弃！！！
[Carte APIs]https://help.hitachivantara.com/Documentation/Pentaho/9.1/Developer_center/REST_API_Reference/Carte